Bootstrap: docker
From: nvcr.io/nvidia/nvhpc:22.5-devel-cuda11.7-ubuntu20.04


%environment
	# pyenv
	export PYTHON_VERSION="3.9.12"
	export PYENV_ROOT="/opt/pyenv"
	export PATH="${PYENV_ROOT}/shims:${PYENV_ROOT}/bin:${PATH}"
	# eval "$(pyenv init -)"
	# source /etc/profile.d/lmod.sh

%post
	# Install package
	apt-get update
	DEBIAN_FRONTEND=noninteractive apt-get install -y \
	sudo \
	ca-certificates \
	git \
	curl \
	patch \
	make \
	cmake \
	gcc \
	g++ \
	openssl \
	libssl-dev \
	libbz2-dev \
	libreadline-dev \
	libsqlite3-dev \
	libffi-dev \
	zlib1g-dev \
	liblzma-dev \
	locales-all

	# Clean up
	apt-get clean
	rm -rf /var/lib/apt/lists/*

	# Install pyenv
	export PYENV_ROOT="/opt/pyenv"
	git clone https://github.com/pyenv/pyenv.git ${PYENV_ROOT}
	export PATH="$PYENV_ROOT/bin:$PATH"
	eval "$(pyenv init -)"
	export PYTHON_VERSION="3.9.12"
	pyenv install ${PYTHON_VERSION}
	pyenv global ${PYTHON_VERSION}
	pyenv rehash
	python -m pip install --upgrade pip
	# pip install matplotlib mpi4py

	# Install poetry
	# curl -sSL https://install.pyt	hon-poetry.org | POETRY_HOME=/opt/poetry python -

	# Install local nest-gpu
	# autoreconf -i
	# ./configure
	# make
	# make intall
